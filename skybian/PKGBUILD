pkgname=skybian
_pkgname=skybian
pkgdesc="Packaged modifications to the skybian image - debian package"
pkgver='0.4.0'
_pkgver=${pkgver}
pkgrel=4
_pkgrel=${pkgrel}
arch=( 'any' )
_pkgarch="arm64"
_pkgpath="github.com/skycoin/${_pkgname}"
url="https://${_pkgpath}"
makedepends=('dpkg')
depends=()
_rms="raw/master/static"
source=(
"10-skybian-header"
"armbian-check-first-login.sh"
"armbian-motd"
"skybian-firstrun.sh"
"skybian-firstrun.service"
"postinst.sh"
"skybian-autoconfig.sh"
)
sha256sums=('1aae9938793bf2b8a9572c8c29dfb589cee1543b1ca1033116e27445402c5177'
            'd35fb793968e8dfd1c452a4468225aab1138b883d37b451187e6e3536eea1a0a'
            '63c9148474d4a6197e1f50b110bdb93abef79382a6c2335cd8e8381031d76b2e'
            '93d10da6eb9a1ce6c4757c65e96b42a3d678b6b7d47689afd375c0f97f769ad2'
            'cf6c04cc3b0d3ae7a048b04ab2c805fc1699da8f3d4c6dd2329295fc1fab6ef0'
            '9181f240d5eed32e58b097f60ee0d1b020ab85ec52d724222976e44469761faf'
            '0bc5efd0f33f761a71d88d31ba689be855f1957423e1a1e9612e54c3579015e0')
#'SKIP')


build() {
  #create control file for the debian package
  echo "Package: ${_pkgname}" > ${srcdir}/control
  echo "Version: ${_pkgver}-${_pkgrel}" >> ${srcdir}/control
  echo "Priority: optional" >> ${srcdir}/control
  echo "Section: web" >> ${srcdir}/control
  echo "Architecture: ${_pkgarch}" >> ${srcdir}/control
  #echo "Depends: ${_debdeps}" >> ${srcdir}/control
  echo "Maintainer: Skycoin" >> ${srcdir}/control
  echo "Description: ${pkgdesc}" >> ${srcdir}/control
}


package() {

  _msg2 'creating dirs'
  #set up to create a .deb package
  _debpkgdir="${_pkgname}-${pkgver}-${_pkgrel}-${_pkgarch}"
  _pkgdir="${pkgdir}/${_debpkgdir}"
  #########################################################################
  #PACKAGE AS YOU NORMALLY WOULD HERE USING ${_pkgdir} instead of ${pkgdir}
  mkdir -p ${_pkgdir}/etc/update-motd.d/
  mkdir -p ${_pkgdir}/etc/default/
  mkdir -p ${_pkgdir}/etc/profile.d/
  mkdir -p ${_pkgdir}/etc/systemd/system/
  mkdir -p ${_pkgdir}/usr/bin/
  install -Dm755 ${srcdir}/10-skybian-header ${_pkgdir}/etc/update-motd.d/
  install -Dm755 ${srcdir}/armbian-check-first-login.sh ${_pkgdir}/etc/profile.d/
  install -Dm644 ${srcdir}/armbian-motd ${_pkgdir}/etc/default/
  install -Dm755 ${srcdir}/skybian-firstrun.sh ${_pkgdir}/usr/bin/skybian-firstrun
  install -Dm755 ${srcdir}/skybian-autoconfig.sh ${_pkgdir}/usr/bin/skybian-autoconfig
  install -Dm644 ${srcdir}/skybian-firstrun.service ${_pkgdir}/etc/systemd/system/skybian-firstrun.service
  #########################################################################
  _msg2 'installing control file and postinst script'
  install -Dm755 ${srcdir}/control ${_pkgdir}/DEBIAN/control
  install -Dm755 ${srcdir}/postinst.sh ${_pkgdir}/DEBIAN/postinst
  _msg2 'creating the debian package'
  cd $pkgdir
  dpkg-deb --build -z9 ${_debpkgdir}
  mv *.deb ../../
  #exit so the arch package doesn't get built
  exit
}

_msg2() {
	(( QUIET )) && return
	local mesg=$1; shift
	printf "${BLUE}  ->${ALL_OFF}${BOLD} ${mesg}${ALL_OFF}\n" "$@"
}
